<block-container>
  <block ref={ ref('block') } class="block-container-inner" is-container={ true } { ...props }>
    <div slot="modal">
      <div class="form-group">
        <label>
          Container Class
        </label>
        <input class="form-control" ref="container" value={ props.block.container || 'container' } onchange={ onContainerClass } />
      </div>
    </div>

    <div slot="body">
      <span class="eden-dropzone-label" if={ !props.preview }>
        Container #{ props.placement }
      </span>
      <eden-add type="top" onclick={ props.onAddBlock } way="unshift" placement={ `${props.placement}.children` } if={ !props.preview } />
      
      <div class={ `${props.block.container || 'container'} ${eden.get('user.acl.validate')('admin') && !props.preview ? 'eden-dropzone' : ''} ${ classes({ 'empty' : !getBlocks().length })}` } data-placement={ `${props.placement}.children` }>
        <div if={ !getBlocks().length } class="py-5 text-center">Add Elements</div>
        <div each={ (child, a) in getBlocks() } class={ child.class } is={ getElement(child) } { ...getProps(child, a, `${props.placement}.children.${a}`) } />
      </div>
      
      <eden-add type="bottom" onclick={ props.onAddBlock } way="push" placement={ `${props.placement}.children` } if={ !props.preview } />
      <span class="eden-dropzone-label eden-dropzone-label-end" if={ !props.preview }>
        Container #{ props.placement } End
      </span>
    </div>
  </block>
  
  <script>
    // import base class
    import Base from '../js/base';

    // export block container class
    export default class BlockContainer extends Base {

      // on before mount
      onBeforeMount() {
        // run super
        super.onBeforeMount(...arguments);

        // blocks props
        this.getProps = this.getProps.bind(this);
        this.getBlocks = this.getBlocks.bind(this);
        this.getElement = this.getElement.bind(this);
        this.onContainerClass = this.onContainerClass.bind(this);
      }

      /**
       * gets child props
       *
       * @return {Object}
       */
      getProps(child, i, placement) {
        // return
        return Object.assign({}, this.props, {
          i,
          placement,

          data  : this.props.getData(child),
          class : child.class || '',
          block : child,


          'data-block' : child.uuid,
        })
      }

      /**
       * get blocks
       *
       * @param  {Array} blocks
       *
       * @return {Array}
       */
      getBlocks () {
        // return filtered blocks
        return (this.props.block.children || []).filter((child) => child);
      }
      
      /**
       * get element
       *
       * @param  {Object} child
       *
       * @return {*}
       */
      getElement (child) {
        // return get child
        return (this.props.getData(child) || {}).tag ? 'block-' + (this.props.getData(child) || {}).tag : 'eden-loading';
      }

      /**
       * on class
       *
       * @param  {Event} e
       */
      async onContainerClass (e) {
        // prevent default
        e.preventDefault();
        e.stopPropagation();

        // set class
        this.props.block.container = e.target.value.length ? e.target.value : null;

        // run opts
        if (this.props.onSave) await this.props.onSave(this.props.block, this.props.data, this.props.placement);
      }
    }
  </script>
</block-container>
